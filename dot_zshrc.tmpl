# http://blog.askesis.pl/post/2017/04/how-to-debug-zsh-startup-time.html
# uncomment this and zprof at the end of this file to profile zsh startup
# zmodload zsh/zprof

#emulate sh -c '. /etc/profile'

set -o vi

# set terminal preference for i3
export TERMINAL=kitty

{{ if eq .chezmoi.os "darwin" }}
	export BROWSER="open -a Google\ Chrome"
{{ else if eq .chezmoi.os "linux" }}
	export BROWSER=google-chrome-stable
{{ end }}


{{/*
# =============================================================================
#
# FZF CONFIGURATION
#
# =============================================================================
*/}}

{{/*
# -----------------------------------------------------------------------------
# FZF Default Command (for standalone fzf and Ctrl+T)
# -----------------------------------------------------------------------------
# Sets the default command to list files sorted by modification date.
*/}}
{{ if eq .chezmoi.os "darwin" }}
  {{/* --- macOS Configuration --- */}}
  {{ if (lookPath "fd") }}
    export FZF_DEFAULT_COMMAND="fd --type f --hidden --follow --exclude '.git' -0 | xargs -0 -r stat -f '%m %N' | sort -nr | sed 's/^[^ ]* //'"
  {{ else }}
    export FZF_DEFAULT_COMMAND="find . -type f -print0 | xargs -0 -r stat -f '%m %N' | sort -nr | sed 's/^[^ ]* //'"
  {{ end }}
{{ else if eq .chezmoi.os "linux" }}
  {{/* --- Linux Configuration --- */}}
  {{ if (lookPath "fd") }}
    export FZF_DEFAULT_COMMAND="fd --type f --hidden --follow --exclude '.git' -0 | xargs -0 -r stat -c '%Y %n' | sort -nr | sed 's/^[^ ]* //'"
  {{ else }}
    export FZF_DEFAULT_COMMAND="find . -type f -printf '%T@ %p\n' | sort -nr | sed 's/^[^ ]* //'"
  {{ end }}
{{ end }}

{{/*
# -----------------------------------------------------------------------------
# FZF Preview Command
# -----------------------------------------------------------------------------
# Sets a universal preview command, checking for `bat` and `tree`.
*/}}
{{- $filePreviewer := "cat {}" -}}
{{- if (lookPath "bat") -}}
{{-   $filePreviewer = "bat --style=numbers,changes --wrap never --color always {}" -}}
{{- end -}}

{{- $dirPreviewer := "ls -la {}" -}}
{{- if (lookPath "tree") -}}
{{-   $dirPreviewer = "tree -C {}" -}}
{{- end -}}

export FZF_PREVIEW_COMMAND="if [ -d {} ]; then {{ $dirPreviewer }}; else {{ $filePreviewer }}; fi"

{{/*
# -----------------------------------------------------------------------------
# FZF Keybinding Options (Ctrl+T, Ctrl+R, Alt+C)
# -----------------------------------------------------------------------------
*/}}
# Use the default command for Ctrl+T and add preview options.
export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
export FZF_CTRL_T_OPTS="--min-height 30 --preview-window down:60% --preview-window noborder --preview '($FZF_PREVIEW_COMMAND) 2> /dev/null' --tiebreak=index"

# Options for Alt+C (directory changer).
{{ if (lookPath "tree") -}}
export FZF_ALT_C_OPTS="--preview 'tree -C {} | head -200'"
{{ end -}}

# Options for Ctrl+R (history search) with copy-to-clipboard functionality.
export FZF_CTRL_R_OPTS="--preview 'echo {}' --preview-window down:3:hidden:wrap \
  --bind '?:toggle-preview' \
  --bind 'ctrl-y:execute-silent(echo -n {2..} \
  | (xsel -ib || pbcopy))+abort' \
  --color header:italic \
  --header 'Press CTRL-Y to copy command into clipboard'"

{{/*
# -----------------------------------------------------------------------------
# FZF Fuzzy Completion Commands (**<TAB>)
# -----------------------------------------------------------------------------
# Override the default completion functions to sort by modification date.
*/}}
# Override for file completion.
_fzf_compgen_path() {
  local path="${1:-.}"
  {{ if eq .chezmoi.os "darwin" -}}
    {{ if (lookPath "fd") -}}
      fd --type f --hidden --follow --exclude '.git' . "$path" -0 | xargs -0 -r stat -f '%m %N' | sort -nr | sed 's/^[^ ]* //'
    {{ else -}}
      find "$path" -type f -print0 | xargs -0 -r stat -f '%m %N' | sort -nr | sed 's/^[^ ]* //'
    {{ end -}}
  {{ else if eq .chezmoi.os "linux" -}}
    {{ if (lookPath "fd") -}}
      fd --type f --hidden --follow --exclude '.git' . "$path" -0 | xargs -0 -r stat -c '%Y %n' | sort -nr | sed 's/^[^ ]* //'
    {{ else -}}
      find "$path" -type f -printf '%T@ %p\n' | sort -nr | sed 's/^[^ ]* //'
    {{ end -}}
  {{ end -}}
}

# Override for directory completion.
_fzf_compgen_dir() {
  local path="${1:-.}"
  {{ if (lookPath "fd") -}}
    fd --type d --hidden --follow --exclude ".git" . "$path"
  {{ else -}}
    find "$path" -type d
  {{ end -}}
}

# for existing man pages
function fzf_apropos() {
	apropos . | fzf --preview-window=up:50% --preview 'echo {} | cut -f 1 -d "(" | xargs man'
	# apropos '' | fzf --preview-window=up:50% --preview 'echo {} | cut -f 1 -d " " | xargs man' | cut -f 1 -d " "
}

# Fix SDL full screen output to correct monitor
export SDL_VIDEO_FULLSCREEN_HEAD=0
# export DOCKER_DEFAULT_PLATFORM=linux/amd64

{{- if eq .chezmoi.os "darwin" -}}
export MAKEFLAGS="-j{{ output "sysctl" "-n" "hw.ncpu" | trim }}"
{{- else -}}
export MAKEFLAGS="-j{{ output "nproc" | trim }}"
{{- end }}
export BAT_THEME=TwoDark
export BAT_STYLE=plain

export OLLAMA_ORIGINS="app://obsidian.md*"
export HOMEBREW_BUNDLE_FILE="~/Brewfile"

# Remove "/" from WORDCHARS so that Ctrl+W doesn't kill directory paths.
WORDCHARS="${WORDCHARS//[\/]}"

# Load brew and related completions if it is installed
# Prepend homebrew to path
# Avoid using brew shellenv for setup, because brew completions are messed up
# Handle macos and linux paths for homebrew

# Cache brew prefix to avoid multiple calls (improves shell startup performance)
{{ if eq .chezmoi.os "darwin" }}
if type /opt/homebrew/bin/brew &> /dev/null; then
  path=("/opt/homebrew/bin" "/opt/homebrew/sbin" $path)
  export HOMEBREW_PREFIX="/opt/homebrew"
fi
{{ else if eq .chezmoi.os "linux" }}
if type /home/linuxbrew/.linuxbrew/bin/brew &> /dev/null; then
  path=("/home/linuxbrew/.linuxbrew/bin" "/home/linuxbrew/.linuxbrew/sbin" $path)
  export HOMEBREW_PREFIX="/home/linuxbrew/.linuxbrew"
fi
{{ end }}

eval "$(mise activate zsh)"

# Set these envs after mise has been initialized since neovim may be installed by mise.
# Nvim exists in my home folder in some environments.
# This will find it in my path and get the absolute path.
# The absolute path is required so that sudoedit will be able to
# find the executable, because my personal bin folder does not exist
# in the path of the root user.
NVIM=$(whence -p nvim)

if command -v nvim >/dev/null 2>&1; then
	export EDITOR='nvim'
	export VISUAL='nvim'
  export MANPAGER='nvim +Man!'
	export SUDO_EDITOR=$NVIM
else
	export EDITOR='vim'
	export VISUAL='vim'
	export SUDO_EDITOR='vim'
fi


#======================================================================
# History Configuration
#======================================================================

setopt extended_history       # record timestamp of command in HISTFILE
setopt hist_expire_dups_first # delete duplicates first when HISTFILE size exceeds HISTSIZE
setopt hist_ignore_dups       # ignore duplicated commands history list
setopt hist_ignore_space      # ignore commands that start with space
setopt hist_verify            # show command with history expansion to user before running it
setopt share_history          # share command history data

## History command wrapper (from Oh My Zsh)
# https://github.com/ohmyzsh/ohmyzsh/blob/master/lib/history.zsh
function omz_history {
  local clear list
  zparseopts -E c=clear l=list

  if [[ -n "$clear" ]]; then
    # if -c provided, clobber the history file
    echo -n >| "$HISTFILE"
    fc -p "$HISTFILE"
    echo >&2 History file deleted.
  elif [[ -n "$list" ]]; then
    # if -l provided, run as if calling `fc' directly
    builtin fc "$@"
  else
    # unless a number is provided, show all history events (starting from 1)
    [[ ${@[-1]-} = *[0-9]* ]] && builtin fc -l "$@" || builtin fc -l "$@" 1
  fi
}

# Timestamp format
case ${HIST_STAMPS-} in
  "mm/dd/yyyy") alias history='omz_history -f' ;;
  "dd.mm.yyyy") alias history='omz_history -E' ;;
  "yyyy-mm-dd") alias history='omz_history -i' ;;
  "") alias history='omz_history' ;;
  *) alias history="omz_history -t '$HIST_STAMPS'" ;;
esac

# Save stack on every directory change
chpwd() {
  print -r "$(date -Iseconds) $TTY $PWD" >> ~/.directory_history
}

#======================================================================
# Zsh Options (setopt)
#======================================================================

# Customize the partial line indicator (shown when output doesn't end with newline)
PROMPT_EOL_MARK='%B%F{red}⮒%f%b'

setopt auto_cd              # change directories without cd
setopt complete_in_word
setopt always_to_end
setopt interactivecomments
setopt multios
setopt prompt_subst
setopt auto_menu
# Extended glob can be problematic with git commands
# Because of HEAD^ etc in commands
setopt extendedglob


#======================================================================
# Completion System Configuration (zstyle)
#======================================================================

# General completion settings
# https://grml.org/zsh/zsh-lovers.html
# Fuzzy matching of completions for when you mistype them:
zstyle ':completion:*' completer _complete _match _approximate
zstyle ':completion:*:match:*' original only
zstyle ':completion:*:approximate:*' max-errors 1 numeric
# cd will never select the parent directory (e.g.: cd ../<TAB>):
zstyle ':completion:*:cd:*' ignore-parents parent pwd
zstyle ':completion:*' file-sort modification

# fzf-tab specific styles
zstyle ':completion:*:git-checkout:*' sort false # disable sort when completing `git checkout`
zstyle ':completion:*:descriptions' format '[%d]' # set descriptions format to enable group support
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS} # set list-colors (needs verification)
zstyle ':fzf-tab:complete:cd:*' fzf-preview 'lsd --depth 1 --color always --tree $realpath' # preview directory content
zstyle ':fzf-tab:*' switch-group ',' '.' # switch group using `,` and `.`
# tldr preview example:
# zstyle ':fzf-tab:complete:tldr:argument-1' fzf-preview 'tldr --color always $word'
# systemd unit status preview (Linux only)
zstyle ':fzf-tab:complete:systemctl-*:*' fzf-preview 'SYSTEMD_COLORS=1 systemctl status $word'
# Git previews
zstyle ':fzf-tab:complete:git-(add|diff|restore):*' fzf-preview \
	'git diff $word | delta'
zstyle ':fzf-tab:complete:git-log:*' fzf-preview \
	'git log --color=always $word'
zstyle ':fzf-tab:complete:git-help:*' fzf-preview \
	'git help $word | bat -plman --color=always'
zstyle ':fzf-tab:complete:git-show:*' fzf-preview \
	'case "$group" in
	"commit tag") git show --color=always $word ;;
	*) git show --color=always $word | delta ;;
	esac'
zstyle ':fzf-tab:complete:git-checkout:*' fzf-preview \
	'case "$group" in
	"modified file") git diff $word | delta ;;
	"recent commit object name") git show --color=always $word | delta ;;
	*) git log --color=always $word ;;
	esac'

# Enable IP addresses in completions (moved from fzf-tab section for clarity)
zstyle ':completion:*' use-ip true


#======================================================================
# Helper Functions & Widgets
#======================================================================

# Rationalise dots for quick directory changes (cd ../<TAB>)
rationalise-dot() {
  if [[ $LBUFFER = *.. ]]; then
    LBUFFER+=/..
  else
    LBUFFER+=.
  fi
}
zle -N rationalise-dot
bindkey . rationalise-dot


#======================================================================
# Plugin Sourcing
#======================================================================

# source "$HOME/.asdf/plugins/golang/set-env.zsh" # Example if needed
# command -v direnv &>/dev/null && eval "$(direnv hook zsh)" # Example if needed
# source "${XDG_CONFIG_HOME:-$HOME/.config}/asdf-direnv/zshrc" &>/dev/null
# autoload -Uz zkbd # Load zkbd module (used for keybindings below, if uncommented)

## Plugins (Load before zsh-vi-mode if they don't depend on its bindings)
[ -f ~/zsh/zsh-syntax-highlighting/zsh-syntax-highlighting.plugin.zsh ] && \
  source ~/zsh/zsh-syntax-highlighting/zsh-syntax-highlighting.plugin.zsh
[ -f ~/zsh/zsh-autosuggestions/zsh-autosuggestions.plugin.zsh ] && \
  source ~/zsh/zsh-autosuggestions/zsh-autosuggestions.plugin.zsh


#======================================================================
# FZF Sourcing (keybindings & completions)
#======================================================================

# Source fzf keybindings and completions
source <(fzf --zsh)


#======================================================================
# Custom Functions
#======================================================================

# GitHub Issues → Claude: select issue and process with git:issue skill
ghi() {
  local selection
  selection=$(gh issue list --json number,title,labels,updatedAt \
    --jq '.[] | [
      "#\(.number)",
      (if (.labels | length) > 0 then (.labels | map(.name) | join(","))[:20] else "-" end),
      (.updatedAt | fromdateiso8601 | strftime("%Y-%m-%d")),
      .title[:60]
    ] | @tsv' | \
    column -t -s $'\t' | \
    fzf --ansi \
        --header '#       Labels               Updated     Title' \
        --preview 'gh issue view {1}' \
        --preview-window right:60%:wrap \
        --bind 'ctrl-/:toggle-preview' \
        --bind 'ctrl-d:preview-page-down,ctrl-u:preview-page-up')

  [[ -z "$selection" ]] && return 0

  local issue_num="${${selection##*#}%% *}"
  echo "Processing issue #$issue_num with Claude..."
  claude "/git-plugin:git:issue $issue_num"
}

# GitHub PRs → Claude: select PR and address workflow/review feedback
ghpc() {
  local selection
  selection=$(gh pr list --json number,title,headRefName,isDraft,statusCheckRollup,reviewDecision,updatedAt \
    --jq '.[] | [
      "#\(.number)",
      (if .isDraft then "draft" else "ready" end),
      (if (.statusCheckRollup | length) == 0 then "⏳CI"
       elif (.statusCheckRollup | all(.conclusion == "SUCCESS")) then "✓CI"
       elif (.statusCheckRollup | any(.conclusion == "FAILURE")) then "✗CI"
       else "⏳CI" end),
      (if .reviewDecision == "APPROVED" then "✓rev"
       elif .reviewDecision == "CHANGES_REQUESTED" then "✗rev"
       elif .reviewDecision == "REVIEW_REQUIRED" then "⏳rev"
       else "-rev" end),
      .headRefName[:25],
      .title[:45]
    ] | @tsv' | \
    column -t -s $'\t' | \
    fzf --ansi \
        --header '#       State  CI    Review  Branch                    Title' \
        --preview 'gh pr view {1} && echo && echo "--- Checks ---" && gh pr checks {1}' \
        --preview-window right:60%:wrap \
        --bind 'ctrl-/:toggle-preview' \
        --bind 'ctrl-d:preview-page-down,ctrl-u:preview-page-up')

  [[ -z "$selection" ]] && return 0

  local pr_num="${${selection##*#}%% *}"
  echo "Addressing PR #$pr_num feedback with Claude..."
  claude "Check the PR #$pr_num workflow results and read the PR comments and address substantive feedback and suggestions"
}

# Interactive PR merge with fzf preview (squash)
ghsq() {
  if [[ $# -eq 0 ]]; then
    # No args: interactive fzf selection
    local pr=$(gh pr list --limit 100 | \
      fzf --ansi \
          --preview 'gh pr view {1} && echo && gh pr diff {1} --color=always | head -100' \
          --preview-window right:65%:wrap \
          --bind 'ctrl-/:toggle-preview' \
          --bind 'ctrl-d:preview-page-down,ctrl-u:preview-page-up' \
          --header '⏎ squash-merge | ^/ toggle preview | ^d/u scroll' | \
      awk '{print $1}')
    [[ -n "$pr" ]] && gh pr merge "$pr" --squash --delete-branch
  else
    # Args provided: pass through directly (preserves tab completion)
    gh pr merge "$@" --squash --delete-branch
  fi
}

# Interactive PR merge with fzf preview (rebase)
ghrb() {
  if [[ $# -eq 0 ]]; then
    # No args: interactive fzf selection
    local pr=$(gh pr list --limit 100 | \
      fzf --ansi \
          --preview 'gh pr view {1} && echo && gh pr diff {1} --color=always | head -100' \
          --preview-window right:65%:wrap \
          --bind 'ctrl-/:toggle-preview' \
          --bind 'ctrl-d:preview-page-down,ctrl-u:preview-page-up' \
          --header '⏎ rebase-merge | ^/ toggle preview | ^d/u scroll' | \
      awk '{print $1}')
    [[ -n "$pr" ]] && gh pr merge "$pr" --rebase --delete-branch
  else
    # Args provided: pass through directly (preserves tab completion)
    gh pr merge "$@" --rebase --delete-branch
  fi
}


{{ if eq .chezmoi.os "darwin" }}
# Power usage monitor - shows top energy-consuming processes
# Usage: power [-n COUNT] [--json] [--help]
power() {
  local count=15
  local json_output=false
  local sample_ms=5000

  # Parse arguments
  while [[ $# -gt 0 ]]; do
    case "$1" in
      -n)
        count="$2"
        shift 2
        ;;
      --json)
        json_output=true
        shift
        ;;
      -t)
        sample_ms="$2"
        shift 2
        ;;
      --help|-h)
        cat <<'EOF'
power - Monitor process energy consumption on macOS

Usage: power [-n COUNT] [-t MS] [--json] [--help]

Options:
  -n COUNT    Number of processes to show (default: 15)
  -t MS       Sample duration in milliseconds (default: 5000)
  --json      Output as JSON instead of table
  --help      Show this help message

Examples:
  power              # Show top 15 processes
  power -n 20        # Show top 20 processes
  power --json       # Output as JSON
  power -t 10000     # Sample for 10 seconds

Note: Requires sudo for powermetrics access.
EOF
        return 0
        ;;
      *)
        echo "Unknown option: $1" >&2
        return 1
        ;;
    esac
  done

  # Run powermetrics and parse output
  local raw_output
  raw_output=$(sudo powermetrics --samplers tasks --show-process-energy -n 1 -i "$sample_ms" 2>/dev/null)

  if [[ $? -ne 0 ]]; then
    echo "Error: Failed to run powermetrics. Make sure you have sudo access." >&2
    return 1
  fi

  if $json_output; then
    # JSON output
    local timestamp
    timestamp=$(date -u +"%Y-%m-%dT%H:%M:%SZ")

    echo "$raw_output" | awk -v count="$count" -v ts="$timestamp" -v sample_ms="$sample_ms" '
      BEGIN {
        started = 0
        idx = 0
        printf "{\n  \"sample_duration_ms\": %s,\n  \"timestamp\": \"%s\",\n  \"processes\": [\n", sample_ms, ts
      }
      /^Name[[:space:]]+ID[[:space:]]+CPU/ { started = 1; next }
      started && NF >= 6 && $1 !~ /^(DEAD_TASKS|ALL_TASKS|kernel_task)$/ {
        if (idx >= count) exit
        name = $1
        pid = $2
        cpu = $3
        energy = $6
        if (idx > 0) printf ",\n"
        printf "    {\"name\": \"%s\", \"pid\": %s, \"cpu_ms_per_s\": %s, \"energy_impact\": %s}", name, pid, cpu, energy
        idx++
      }
      END {
        printf "\n  ]\n}\n"
      }
    '
  else
    # Table output
    echo "Sampling for $(( sample_ms / 1000 )) seconds..."
    echo ""
    printf "%-30s %8s %12s %15s\n" "Process" "PID" "CPU ms/s" "Energy Impact"
    printf "%-30s %8s %12s %15s\n" "──────────────────────────────" "────────" "────────────" "───────────────"

    echo "$raw_output" | awk -v count="$count" '
      /^Name[[:space:]]+ID[[:space:]]+CPU/ { started = 1; next }
      started && NF >= 6 && $1 !~ /^(DEAD_TASKS|ALL_TASKS|kernel_task)$/ {
        if (idx >= count) exit
        printf "%-30s %8s %12s %15s\n", $1, $2, $3, $6
        idx++
      }
    '
  fi
}
{{ end }}

#======================================================================
# Aliases
#======================================================================

# Load aliases after plugins so that conditional aliases for executables managed
# by asdf can be found and aliased correctly.
[ -f ~/aliases.zsh ] && source ~/aliases.zsh


#======================================================================
# Environment Variables & Path
#======================================================================

# Android SDK (for Tauri Android development)
export ANDROID_HOME="/opt/homebrew/share/android-commandlinetools"
export NDK_HOME="$ANDROID_HOME/ndk/26.1.10909125"
export PATH="$ANDROID_HOME/platform-tools:$PATH"

# bun
export BUN_INSTALL="$HOME/.bun"
export PATH="$BUN_INSTALL/bin:$PATH"


#======================================================================
# Tool Initializations (Starship, Zoxide, Atuin, etc.)
#======================================================================

eval "$(starship init zsh)"
eval "$(zoxide init zsh)"
eval "$(atuin init zsh)"

{{ if eq .chezmoi.os "darwin" }}
# OrbStack (macOS only) - moved after compinit to avoid compdef errors
# eval "$(orbctl completion zsh)"
# eval "$(orb completion zsh)"
{{ end }}


#======================================================================
# Completion System Initialization
#======================================================================

# Add custom completion directory to fpath (if not already added above)
# NOTE: This needs to be before compinit
[ -d ~/.zfunc ] && fpath+=~/.zfunc

# Load Homebrew path configurations (if available)
# Path modifications should be done before compinit
if [ -n "$HOMEBREW_PREFIX" ]; then
    # google-cloud-sdk path (this modifies PATH, so keep it before compinit)
    [ -f "$HOMEBREW_PREFIX/share/google-cloud-sdk/path.zsh.inc" ] && \
      source "$HOMEBREW_PREFIX/share/google-cloud-sdk/path.zsh.inc" 2>/dev/null
fi

# bun completions
[ -s "$HOME/.bun/_bun" ] && source "$HOME/.bun/_bun"

# Initialize the completion system
autoload -Uz compinit && compinit

# Load completions that must run *after* compinit
# Note: Completion definitions must be loaded AFTER compinit to ensure
# they are properly registered with the zsh completion system

# Enable completions for custom gh wrapper functions
compdef ghsq=gh
compdef ghrb=gh
compdef ghi=gh
compdef ghpc=gh

[ -f ~/zsh/fzf-tab/fzf-tab.plugin.zsh ] && \
  source ~/zsh/fzf-tab/fzf-tab.plugin.zsh

# Load Google Cloud SDK completions (after compinit)
if [ -n "$HOMEBREW_PREFIX" ]; then
    [ -f "$HOMEBREW_PREFIX/share/google-cloud-sdk/completion.zsh.inc" ] && \
      source "$HOMEBREW_PREFIX/share/google-cloud-sdk/completion.zsh.inc" 2>/dev/null
fi

# Load Homebrew bash completions (if available)
# Requires bashcompinit to be loaded after compinit
if [ -n "$HOMEBREW_PREFIX" ]; then
    # Enable loading bash completions
    autoload -U +X bashcompinit && bashcompinit

    # Load specific bash completions provided by brew packages
    # Example: Terraform completions
    if [ -x "$HOMEBREW_PREFIX/bin/terraform" ]; then
      complete -o nospace -C "$HOMEBREW_PREFIX/bin/terraform" terraform
    fi
    # Add other bash completions here if needed
fi


#======================================================================
# Keybindings
#======================================================================

# Unbind problematic bindings
# bindkey -r "^[" # Example: Unbind Alt key if needed

# Alt+c for fzf-cd-widget (Mapped in kitty.conf to send ESC+c)
bindkey '\ec' fzf-cd-widget

# macos specific binds that make it possible to use option+left/right to move by word.
# This also allows partial completion of suggestions by zsh-autosuggestions.
bindkey '\x1bb' backward-word
bindkey '\x1bf' forward-word

# Add a PC-like bind for pipe on macos (Command + <)
# This sequence "^[[60;9u" might be specific to your terminal/setup
bindkey -s "^[[60;9u" "|"

# Example zkbd usage (uncomment and configure if needed)
# source ~/.zkbd/$TERM-${${DISPLAY:t}:-$VENDOR-$OSTYPE}
# [[ -n ${key[Left]} ]] && bindkey "${key[Left]}" backward-char
# [[ -n ${key[Right]} ]] && bindkey "${key[Right]}" forward-char


#======================================================================
# Profiling (Optional)
#======================================================================
# zprof # Uncomment this if zmodload zsh/zprof is uncommented at the top
