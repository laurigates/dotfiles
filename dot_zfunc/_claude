#compdef claude

# Zsh completion for Claude Code CLI
# Auto-generated by scripts/generate-claude-completion-simple.sh
# Maintained as part of chezmoi dotfiles configuration

_claude() {
    local -a commands
    local context state state_descr line
    typeset -A opt_args

    commands=(
        'doctor:Check the health of your Claude Code auto-updater'
        'install:Install Claude Code native build. Use [target] to specify version'
        'mcp:Configure and manage MCP servers'
        'migrate-installer:Migrate from global npm installation to local installation'
        'plugin:Manage Claude Code plugins'
        'setup-token:Set up a long-lived authentication token (requires Claude subscription)'
        'update:Check for updates and install if available'
    )

    _arguments -C \
        '(-d --debug)'{-d,--debug}'[Enable debug mode]' \
        '--verbose[Override verbose mode setting from config]' \
        '(-p --print)'{-p,--print}'[Print response and exit (useful for pipes)]' \
        '--output-format[Output format for --print]:format:(text json stream-json)' \
        '--input-format[Input format for --print]:format:(text stream-json)' \
        '--mcp-debug[DEPRECATED. Use --debug instead. Enable MCP debug mode]' \
        '--dangerously-skip-permissions[Bypass all permission checks]' \
        '--allowedTools[Comma or space-separated list of tool names to allow]:tools:' \
        '--disallowedTools[Comma or space-separated list of tool names to deny]:tools:' \
        '--mcp-config[Load MCP servers from JSON files or strings]:configs:_files' \
        '--append-system-prompt[Append a system prompt to the default system prompt]:prompt:' \
        '--permission-mode[Permission mode to use for the session]:mode:(acceptEdits bypassPermissions default plan)' \
        '(-c --continue)'{-c,--continue}'[Continue the most recent conversation]' \
        '(-r --resume)'{-r,--resume}'[Resume a conversation]:sessionId:' \
        '--model[Model for the current session]:model:_claude_models' \
        '--fallback-model[Enable automatic fallback to specified model]:model:_claude_models' \
        '--settings[Path to a settings JSON file or a JSON string]:file:_files' \
        '--add-dir[Additional directories to allow tool access to]:directories:_files -/' \
        '--ide[Automatically connect to IDE on startup if exactly one valid IDE is available]' \
        '--strict-mcp-config[Only use MCP servers from --mcp-config]' \
        '--session-id[Use a specific session ID for the conversation]:uuid:' \
        '(-v --version)'{-v,--version}'[Output the version number]' \
        '(-h --help)'{-h,--help}'[Display help for command]' \
        '1: :->command' \
        '*: :->args' && return 0

    case $state in
        command)
            _describe -t commands 'claude commands' commands
            ;;
        args)
            case $words[1] in
                mcp)
                    _claude_mcp
                    ;;
                plugin)
                    _claude_plugin
                    ;;
                install)
                    _claude_install
                    ;;
                *)
                    _message 'prompt text'
                    ;;
            esac
            ;;
    esac
}

_claude_plugin() {
    local -a plugin_commands
    plugin_commands=(
        'validate:Validate a plugin or marketplace manifest'
        'marketplace:Manage Claude Code marketplaces'
        'install:Install a plugin from available marketplaces'
        'uninstall:Uninstall an installed plugin'
        'enable:Enable a disabled plugin'
        'disable:Disable an enabled plugin'
        'help:Display help for command'
    )

    _arguments -C \
        '(-h --help)'{-h,--help}'[Display help for command]' \
        '1: :->subcommand' \
        '*: :->args' && return 0

    case $state in
        subcommand)
            _describe -t plugin-commands 'plugin commands' plugin_commands
            ;;
        args)
            case $words[2] in
                validate)
                    _arguments '1:path:_files'
                    ;;
                install|i)
                    _arguments '1:plugin:'
                    ;;
                uninstall|remove)
                    _arguments '1:plugin:'
                    ;;
                enable|disable)
                    _arguments '1:plugin:'
                    ;;
            esac
            ;;
    esac
}

_claude_mcp() {
    local -a mcp_commands
    mcp_commands=(
        'add:<name> <commandOrUrl> Add an MCP server to Claude Code.'
        'add-from-claude-desktop:Import MCP servers from Claude Desktop (Mac and WSL only)'
        'add-json:<name> <json> Add an MCP server (stdio or SSE) with a JSON string'
        'get:<name> Get details about an MCP server'
        'help:display help for command'
        'list:List configured MCP servers'
        'remove:<name> Remove an MCP server'
        'reset-project-choices:Reset all approved and rejected project-scoped (.mcp.json) servers within this project'
        'serve:Start the Claude Code MCP server'
    )

    _arguments -C \
        '(-h --help)'{-h,--help}'[Display help for command]' \
        '1: :->subcommand' \
        '*: :->args' && return 0

    case $state in
        subcommand)
            _describe -t mcp-commands 'mcp commands' mcp_commands
            ;;
        args)
            case $words[2] in
                serve)
                    _arguments \
                        '(-d --debug)'{-d,--debug}'[Enable debug mode]' \
                        '--verbose[Override verbose mode setting from config]'
                    ;;
                add)
                    _arguments \
                        '(-s --scope)'{-s,--scope}'[Configuration scope]:scope:(local user project)' \
                        '(-t --transport)'{-t,--transport}'[Transport type]:transport:(stdio sse http)' \
                        '(-e --env)'{-e,--env}'[Set environment variables]:env:' \
                        '(-H --header)'{-H,--header}'[Set WebSocket headers]:header:' \
                        '1:name:' \
                        '2:commandOrUrl:' \
                        '*:args:'
                    ;;
                remove)
                    _arguments \
                        '(-s --scope)'{-s,--scope}'[Configuration scope]:scope:(local user project)' \
                        '1:name:_claude_mcp_servers'
                    ;;
                get)
                    _arguments \
                        '1:name:_claude_mcp_servers'
                    ;;
                add-json)
                    _arguments \
                        '(-s --scope)'{-s,--scope}'[Configuration scope]:scope:(local user project)' \
                        '1:name:' \
                        '2:json:'
                    ;;
                add-from-claude-desktop)
                    _arguments \
                        '(-s --scope)'{-s,--scope}'[Configuration scope]:scope:(local user project)'
                    ;;
            esac
            ;;
    esac
}

_claude_install() {
    local -a install_targets
    install_targets=(
        'stable:Install stable version'
        'latest:Install latest version'
    )

    _arguments \
        '--force[Force installation even if already installed]' \
        '(-h --help)'{-h,--help}'[Display help for command]' \
        '1: :->target' && return 0

    case $state in
        target)
            _describe -t install-targets 'install targets' install_targets
            _message 'or specific version'
            ;;
    esac
}

# Helper function to complete model names
_claude_models() {
    local -a models
    models=(
        'sonnet:Latest Sonnet model'
        'opus:Latest Opus model'
        'haiku:Latest Haiku model'
        'claude-sonnet-4-20250514:Claude Sonnet 4'
        'claude-3-5-sonnet-20241022:Claude 3.5 Sonnet'
        'claude-3-5-haiku-20241022:Claude 3.5 Haiku'
        'claude-3-opus-20240229:Claude 3 Opus'
    )
    _describe -t models 'claude models' models
}

# Helper function to complete MCP server names
_claude_mcp_servers() {
    local -a servers
    # Try to get actual server names, fallback to common ones
    if command -v claude >/dev/null 2>&1; then
        servers=(${(f)"$(claude mcp list 2>/dev/null | grep -E '^[a-zA-Z0-9_-]+:' | cut -d: -f1)"})
    fi

    # Fallback to common server names if the command fails
    if [[ ${#servers} -eq 0 ]]; then
        servers=(
            'playwright:Playwright MCP server'
            'context7:Context7 MCP server'
            'github:GitHub MCP server'
            'pal:PAL MCP server'
            'vectorcode:VectorCode MCP server'
            'graphiti-memory:Graphiti Memory MCP server'
            'sequential-thinking:Sequential Thinking MCP server'
            'sentry:Sentry MCP server'
        )
    fi
    _describe -t mcp-servers 'MCP servers' servers
}

_claude "$@"
