#!/bin/bash
# Generate ZSH completions for various CLI tools
# Runs when .chezmoidata.toml changes
# Hash: {{ include ".chezmoidata.toml" | sha256sum }}

set -euo pipefail

COMP_DIR="$HOME/.zfunc"
mkdir -p "${COMP_DIR}"

echo "ğŸ”§ Generating ZSH completions in ${COMP_DIR}..."
generated=0
skipped=0

{{- range $tool, $cmd := .packages.completion_tools.zsh_completions }}
if command -v {{ $tool }} >/dev/null 2>&1; then
    echo "ğŸ“ Generating completion for {{ $tool }}..."
    {{ $cmd }} > "${COMP_DIR}/_{{ $tool }}" 2>/dev/null || echo "âš ï¸  Failed to generate {{ $tool }} completion"
    if [[ -f "${COMP_DIR}/_{{ $tool }}" ]]; then
        ((generated++))
    fi
else
    echo "â­ï¸  {{ $tool }} not found, skipping completion"
    ((skipped++))
fi
{{- end }}

echo "âœ… ZSH completions generation completed!"
echo "ğŸ“Š Generated: ${generated}, Skipped: ${skipped}"
echo "ğŸ“ Completions saved in: ${COMP_DIR}"
