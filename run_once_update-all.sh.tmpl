{{- /* chezmoi:template */ -}}
#!/usr/bin/env bash

# Update script for refreshing all tools after a vacation

set -euo pipefail

echo "ğŸ”„ Starting comprehensive update process..."

{{- if eq .chezmoi.os "darwin" }}
# Update Homebrew packages and cleanup
echo "ğŸ“¦ Updating Homebrew packages..."
brew update && brew upgrade && brew cleanup
{{- else if eq .chezmoi.os "linux" }}
# Update Homebrew on Linux
echo "ğŸ“¦ Updating Homebrew packages..."
/home/linuxbrew/.linuxbrew/bin/brew update && /home/linuxbrew/.linuxbrew/bin/brew upgrade && /home/linuxbrew/.linuxbrew/bin/brew cleanup
{{- end }}

# Update mise and its tools
if command -v mise >/dev/null 2>&1; then
    echo "ğŸ› ï¸  Updating mise and tool versions..."
    mise upgrade
else
    echo "âš ï¸  mise not found, skipping tool updates"
fi

# Update Neovim plugins and tools
if command -v nvim >/dev/null 2>&1; then
    echo "âš™ï¸  Updating Neovim plugins and LSP tools..."
    nvim --headless "+Lazy! sync" "+lua require('lazy').load({plugins={'mason.nvim'}})" "+MasonUpdate" +qa
else
    echo "âš ï¸  Neovim not found, skipping plugin updates"
fi

# Update Python packages managed by pipx
if command -v pipx >/dev/null 2>&1; then
    echo "ğŸ Updating Python packages via pipx..."
    pipx upgrade-all
else
    echo "âš ï¸  pipx not found, skipping Python package updates"
fi

echo "âœ… Update process completed successfully!"
